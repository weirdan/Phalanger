<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
	<Compile Include="$(MSBuildThisFileDirectory)\AssemblyInfoCommon.cs">
	  <Link>AssemblyInfoCommon.cs</Link>
	</Compile>
  </ItemGroup>
  
  <Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />
  
  <PropertyGroup>  
    <DocumentationFile>$(OutputPath)$(TargetName).xml</DocumentationFile>
  </PropertyGroup>
  
  <Target Name="BeforeBuild" Condition="'$(OS)' != 'Unix'">
    <Exec Command="&quot;$(ToolsDir)UpdateFileVersionFromChangeset.cmd&quot; &quot;$(RootDir)&quot; &quot;$(MSBuildThisFileDirectory)AssemblyInfoCommon.cs&quot;"></Exec>
  </Target>
  <Target Name="BeforeBuild" Condition="'$(OS)' == 'Unix'" DependsOnTargets="RestorePackages">
    <Exec Command="&quot;$(ToolsDir)UpdateFileVersionFromChangesetNumber.sh&quot; &quot;$(RootDir)&quot; &quot;$(MSBuildThisFileDirectory)AssemblyInfoCommon.cs&quot;"></Exec>
  </Target>

  <Target Name="AfterBuild" Condition=" '$(Configutation)' == 'ReleaseGAC' and '$(OS)' != 'Unix'">
    <Exec Command="&quot;$(ToolsDir)gacutil&quot; /u &quot;$(TargetName)&quot;"></Exec>
    <Exec Command="&quot;$(ToolsDir)gacutil&quot; /f /i &quot;$(TargetPath)&quot;"></Exec>
  </Target>

  <Target Name="AfterBuild" Condition=" '$(Configuration)' == 'Release' and '$(OS)' != 'Unix'">
    <PropertyGroup>
      <OutputNugetPath>$(OutputPath)..\Release-NuGet</OutputNugetPath>
    </PropertyGroup>

    <!-- Only download a new copy of nuget.exe if we don't have a copy available -->
    <!-- WebDownload Condition="!Exists('$(ToolsDir)nuget.exe')" Filename="$(ToolsDir)nuget.exe" FileUri="https://dist.nuget.org/win-x86-commandline/latest/nuget.exe"/-->

    <MakeDir Directories="$(OutputNugetPath)" />
    <Exec Command="&quot;nuget&quot; pack &quot;$(MSBuildProjectFullPath)&quot; -IncludeReferencedProjects -Symbols -Prop Configuration=Release -OutputDirectory &quot;$(OutputNugetPath)&quot;"></Exec>
  </Target>
  <Target Name="BeforeRebuild" DependsOnTarget="RestorePackages"/>
  <Target Name="RestorePackages">
	  <Exec Command="&quot;nuget&quot; restore &quot;$(MSBuildThisFileDirectory)..\..\Solutions\Phalanger.sln&quot;"/>
  </Target>
</Project>
